#!/bin/bash

# set Variabels
BoxWhith=75
BoxStartX=2
BoxStartY=2

# Grafiktreiber installation
dialog \
  --backtitle "PrimeArch" \
  --begin $BoxStartY $BoxStartX \
  --menu "Grafiktreiber wehlen" 15 $BoxWhith 7 \
        1 virtualbox \
        2 Nvidia \
        3 ATI \
        4 Intel \
        5 Nouveau \
        \
        0 'Keine Videotreiber' \
        2>/tmp/grafik_treiber

case $(</tmp/grafik_treiber) in
  1 )
    pacman -S --noconfirm virtualbox-guest-dkms virtualbox-guest-utils
    ;;
  2 )
    pacman -S --noconfirm nvidia
    ;;
  3 )
    pacman -S --noconfirm xf86-video-ati
    ;;
  4 )
    pacman -S --noconfirm xf86-video-intel
    ;;
  5 )
    pacman -S --noconfirm xf86-video-nouveau
    ;;
  0)
    break
    ;;
esac

# GUI installation
dialog \
  --backtitle "PrimeArch Installer" \
  --begin $BoxStartY $BoxStartX \
  --menu "Desktop wehlen" 15 $BoxWhith 8 \
        1 i3 \
        2 Xfce \
        3 Mate \
        4 KDE-Plasma \
        5 Gnome \
        6 Deepin \
        0 'Keinen Desktop' \
        2>/tmp/gui


case $(</tmp/gui) in
  1 )
    pacman -S --noconfirm i3
    ;;
  2 )
    pacman -S --noconfirm xfce4 xfce4-goodies
    ;;
  3 )
    pacman -S --noconfirm mate mate-extra
    ;;
  4 )
    pacman -S --noconfirm plasma
    ;;
  5)
    pacman -S --noconfirm gnome gnome-extra
    ;;
  6)
    pacman -S --noconfirm deepin deepin-extra
    ;;
  0)
    break
    ;;
esac

# INSTALL PACAGES
dialog \
  --backtitle 'PrimeArch Installer' \
  --title 'Pakete installiere' \
  --begin $BoxStartY $BoxStartX \
  --msgbox '

Es werden nun zusäzliche Packete installiert. ' 10 $BoxWhith


pacman -S --noconfirm fish base-devel linux-headers grub os-prober efibootmgr acpid dbus

#Install GUI pakages
pacman -S --noconfirm xdg-user-dirs lightdm lightdm-gtk-greeter

#Install Network pakages
pacman -S --noconfirm avahi networkmanager network-manager-applet nm-connection-editor ntp wireless_tools wpa_supplicant gnome-keyring nfs-utils openssh

#Install Audio pakages
pacman -S --noconfirm alsa-tools alsa-utils pulseaudio pulseaudio-alsa pavucontrol flac volumeicon audacious

#Install Video pakages
pacman -S --noconfirm xorg-server xorg-xinit compton ffmpeg vlc mpv

#Install Additional apps
pacman -S --noconfirm mate-polkit ranger git htop nitrogen terminology vim cronie
pacman -S --noconfirm chromium pluma dmenu conky dunst hunspell-de
pacman -S --noconfirm nemo nemo-fileroller rsync cool-retro-term

#Install Themes
pacman -S --noconfirm lxappearance-gtk3 arc-gtk-theme arc-icon-theme archlinux-wallpaper

#Install fonts
pacman -S --noconfirm gnome-font-viewer noto-fonts awesome-terminal-fonts ttf-ubuntu-font-family

# Set hostname
dialog \
  --backtitle 'PrimeArch Installer' \
  --begin $BoxStartY $BoxStartX \
  --inputbox 'Bitte Hostnamen eingeben' 10 $BoxWhith \
  2>/etc/hostname



# Spracheinstellungen konfigurieren
dialog \
  --backtitle 'PrimeArch Installer' \
  --title 'Pakete installiere' \
  --begin $BoxStartY $BoxStartX \
  --msgbox '

Spracheinstellungen werden konfiguriert ' 10 $BoxWhith


# /etc/locale.conf
echo LANG=de_DE.UTF-8 > /etc/locale.conf
echo LANGUAGE=de_DE >> /etc/locale.conf

# /etc/vconsole.conf
echo KEYMAP=de-latin1-nodeadkeys > /etc/vconsole.conf

# /etc/locale.gen
echo de_DE.UTF-8 UTF-8 >> /etc/locale.gen
locale-gen

# Set Time
rm /etc/localtime
ln -sf /usr/share/zoneinfo/Europe/Berlin /etc/localtime


# Set Root password
clear
echo "############################################"
echo "# ROOT Password festlegen"
echo "#"
echo "#"
echo "# Bitte Password für ROOT eingeben"
echo "#"
passwd

# Set user
clear
echo "############################################"
echo "# Neuen Benutzer erstellen  "
echo "#"
read -p "# Möchten Sie einen neuen Benutzer anlegen? (ja/nein): " MKUSER

case $MKUSER in
  ja )
    clear
    echo "############################################"
    echo "#"
    echo "# Bitte einen Namen für den neuen Benutzer eingeben: "
    read -p " >> " US
    echo "#"
    echo "# Generire Benutzer $US"
    echo "#"
    useradd -m -g users -G wheel,storage,power,network,video,audio,lp -s /usr/bin/fish $US
    echo "# Bitte Password für Benutzer $US eingeben"
    passwd $US
    echo "#"
    echo "# Gebe Benutzer $US ROOT rechte"
    echo "%wheel ALL=(ALL) ALL" >> /etc/sudoers
    ;;

  nein )
    break
    ;;
esac




# GRUB STUFF
dialog \
      --backtitle 'PrimeArch Installer' \
      --title 'GRUB installation' \
      --begin $BoxStartY $BoxStartX \
      --msgbox '

    GRUB wird installiert und konfiguriert' 10 $BoxWhith

if [[ -d "/sys/firmware/efi/efivars" ]];
  then
    # install grub efi
    grub-install --efi-directory=/boot/efi --bootloader-id=Arch_$(</etc/hostname)
  else
    # install grub legacy
    grub-install /dev/$(</tmp/hdd_name)
fi

grub-mkconfig -o /boot/grub/grub.cfg






#start system daemons
dialog \
      --backtitle 'PrimeArch Installer' \
      --title 'System daemons' \
      --begin $BoxStartY $BoxStartX \
      --msgbox '

System daemons werden gestartet' 10 $BoxWhith


systemctl enable acpid
systemctl enable ntpd
systemctl enable lightdm.service

# network managment
systemctl enable avahi-daemon
systemctl enable wpa_supplicant
systemctl enable NetworkManager

# NFS utils
systemctl enable rpcbind

# Cronie
systemctl enable cronie.service







# END SCRIPT 2
dialog \
      --backtitle 'PrimeArch Installer' \
      --title 'System daemons' \
      --begin $BoxStartY $BoxStartX \
      --msgbox '

Bitte System neu starten und als normaler Benutzer anmelden
Nach dem Anmelden Skript 3 starten.' 10 $BoxWhith

exit
